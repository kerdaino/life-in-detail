<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Life in Detail Podcast Blog - Real stories, issues, and solutions posted weekly." />
  <title>Life in Detail Blog</title>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon_io/favicon-16x16.png">
  <link rel="manifest" href="/favicon_io/site.webmanifest">

  <script src="https://kit.fontawesome.com/85eceaceac.js" crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/@sanity/client@5.18.0/dist/sanityClient.browser.min.js"></script> -->

</head>

<body>
  <!-- Fixed Header -->
  <header class="header" role="banner">
    <nav class="navbar" aria-label="Main navigation">
      <div class="logo"><a href="../index.html"><img src="/media/logo.jpeg" alt="Life In Detail Podcast Logo"></a>
      </div>
      <button id="menu-toggle" class="hamburger" aria-label="Open menu" aria-expanded="false"
        aria-controls="side-menu">☰</button>
      <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="#">Episodes</a></li>
        <li><a href="/blog/index.html" aria-current="page">Blog</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <!-- Side Menu -->
  <aside id="side-menu" class="side-menu" role="navigation" aria-hidden="true">
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="#">Episodes</a></li>
      <li><a href="/blog/index.html">Blog</a></li>
      <li><a href="#contact">Contact</a></li>
    </ul>
  </aside>

  <!-- Blog Section -->
  <main style="margin-top: 120px; padding: 2rem;">
    <section aria-labelledby="blog-title">
      <h2 id="blog-title">From the Community</h2>
      <p>Real questions anonymously submitted and Real answers.</p>

      <!-- Blog articles loaded from CMS -->
      <div id="blog-posts" class="blog-grid">
        <!-- These articles will be injected dynamically by headless CMS (Sanity) -->
        <article class="blog-post" role="article">
          <!-- <h3>Dealing with Rejection</h3>
                    <p class="date">June 6, 2025</p>
                    <p class="excerpt">"I feel like no one understands me. I've been trying to get through to my friends
                        but..."</p>
                    <a href="#" class="read-more">Read more</a> -->
        </article>

        <article class="blog-post" role="article">
          <!-- <h3>Finding Hope in Hard Times</h3>
                    <p class="date">May 30, 2025</p>
                    <p class="excerpt">How do you stay hopeful when things just keep going wrong? Here's how I learned
                        to...</p>
                    <a href="#" class="read-more">Read more</a> -->
        </article>
      </div>
    </section>
  </main>

  <!-- Contact Form -->
  <section id="contact" class="contact" aria-labelledby="contact-title">
    <h2 id="contact-title">Partner or Sponsor Us</h2>
    <form action="https://formsubmit.co/5615fff53db8c69217c883b045e32513" method="POST" aria-label="Contact form">
      <input type="text" name="_honey" style="display:none">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" placeholder="Your Name" required />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Your Email" required />

      <label for="message">Message</label>
      <textarea id="message" name="message" placeholder="Your message" required></textarea>

      <button type="submit">Send</button>
    </form>
  </section>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="social-links">
      <a href="https://www.instagram.com/lifeindetailpodcast?igsh=ZmtjZDhsZWt2NW8x&utm_source=qr" target="_blank"
        aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
      <a href="https://www.facebook.com/share/1Ywuw7rbEm/?mibextid=wwXIfr" target="_blank" aria-label="Facebook"><i
          class="fa-brands fa-facebook"></i></a>
      <a href="https://x.com/lifeindetailpod?s=21" target="_blank" aria-label="X"><i
          class="fa-brands fa-x-twitter"></i></a>
      <a href="https://www.tiktok.com/@lifeindetailpodcast?_t=ZM-8wzRJAxI7z4&_r=1" target="_blank"
        aria-label="Tiktok"><i class="fa-brands fa-tiktok"></i></a>
    </div>
    <p><a href="https://kerdaino.github.io/portfolio" target="_blank">&copy; 2025 KD Global. All rights
        reserved.</a></p>
  </footer>

  <script>
    const menuToggle = document.getElementById('menu-toggle');
    const sideMenu = document.getElementById('side-menu');

    function closeMenu() {
      sideMenu.setAttribute('aria-hidden', 'true');
      menuToggle.setAttribute('aria-expanded', 'false');
      sideMenu.classList.remove('open');
    }

    menuToggle.addEventListener('click', () => {
      const isOpen = sideMenu.getAttribute('aria-hidden') === 'false';
      if (isOpen) {
        closeMenu();
      } else {
        sideMenu.setAttribute('aria-hidden', 'false');
        menuToggle.setAttribute('aria-expanded', 'true');
        sideMenu.classList.add('open');
      }
    });

    document.addEventListener('scroll', closeMenu);
    document.addEventListener('click', (e) => {
      if (!sideMenu.contains(e.target) && e.target !== menuToggle) {
        closeMenu();
      }
    });
  </script>


  <script type="module">
    import { createClient } from "https://esm.sh/@sanity/client";

    const client = createClient({
      projectId: "1pmeroly",
      dataset: "production",
      apiVersion: "2023-01-01",
      useCdn: true
    });

    const container = document.getElementById("blog-posts");
    const params = new URLSearchParams(window.location.search);
    const postId = params.get('id');

    if (postId) {
      // Fetch and display full post
      client.fetch(`*[_id == $id][0]`, { id: postId }).then(post => {
        if (!post) {
          container.innerHTML = "<p>Post not found.</p>";
          return;
        }

        const html = `
        <article class="blog-post" role="article">
          <h2>${post.title || post.question}</h2>
          <p class="date">${new Date(post.date).toDateString()}</p>
          <div class="full-content">
            <p>${post.content || post.answer}</p>
          </div>
          <a href="index.html" class="back-link">← Back to all posts</a>
        </article>
      `;
        container.innerHTML = html;
      }).catch(error => {
        console.error("Error loading post:", error);
        container.innerHTML = "<p>Something went wrong. Please try again later.</p>";
      });

    } else {
      // Fetch and list posts
      fetch('/.netlify/functions/get-posts')
        .then(res => res.json())
        .then(posts => {
          container.innerHTML = "";
          posts.forEach(post => {
            const html = `
        <article class="blog-post" role="article">
          <h3>${post.title || post.question}</h3>
          <p class="date">${new Date(post.date).toDateString()}</p>
          <p class="excerpt">${(post.content || post.answer).slice(0, 100)}...</p>
          <a href="index.html?id=${post._id}" class="read-more">Read more</a>
        </article>
      `;
            container.insertAdjacentHTML("beforeend", html);
          });
        })
        .catch(error => {
          console.error("Error loading posts:", error);
          container.innerHTML = `<p style="color:red;">Unable to load posts right now.</p>`;
        });

    }

    // After rendering the full post...

    // Fetch and display comments
    client.fetch(`*[_type == "comment" && post._ref == $postId] | order(date asc)`, { postId }).then(comments => {
      const commentSection = document.createElement('section');
      commentSection.innerHTML = `
    <h3>Comments</h3>
    <div id="comments-list">
      ${comments.map(c => `
        <div class="comment">
          <p><strong>${c.name}</strong> <em>${new Date(c.date).toLocaleDateString()}</em></p>
          <p>${c.message}</p>
        </div>
      `).join('')}
    </div>
    <form id="comment-form">
      <h4>Leave a Comment</h4>
      <input type="text" id="comment-name" placeholder="Your name" required />
      <textarea id="comment-message" placeholder="Your comment" required></textarea>
      <button type="submit">Post Comment</button>
    </form>
  `;

      container.appendChild(commentSection);

      // Submit handler
      const form = document.getElementById("comment-form");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("comment-name").value.trim();
        const message = document.getElementById("comment-message").value.trim();
        if (!name || !message) return;

        try {
          const response = await fetch("/.netlify/functions/post-comment", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              name,
              message,
              postId
            })
          });

          const result = await response.json();

          if (response.ok) {
            alert("Comment submitted!");
            location.reload();
          } else {
            console.error("Server error:", result.error);
            alert("Failed to post comment.");
          }
        } catch (err) {
          console.error("Comment error:", err);
          alert("Failed to post comment.");
        }
      });
    }); // closes the fetch for comments
  </script>



</body>

</html>